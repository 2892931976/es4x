(function (self) {
  if (typeof vertx === 'undefined') {
    var clustered = false;
    var i;

    // jjs shell
    if (typeof load !== 'undefined' && typeof require === 'undefined') {
      // remove the default quit functions
      delete self['exit'];
      delete self['quit'];
      // install the global object
      self['global'] = self;
      // do we want clustering support?
      if (self['arguments']) {
        for (i = 0; i < self['arguments'].length; i++) {
          if (self['arguments'][i] === '--cluster') {
            clustered = true;
            break;
          }
        }
      }
      // will setup vertx + default codec
      self['vertx'] = Java.type('io.reactiverse.es4x.impl.nashorn.NashornJSRuntime').install(JSON, clustered);
      // load polyfills
      load("classpath:io/reactiverse/es4x/polyfill/object.js");
      load("classpath:io/reactiverse/es4x/polyfill/json.js");
      load("classpath:io/reactiverse/es4x/polyfill/global.js");
      load("classpath:io/reactiverse/es4x/polyfill/console.js");
      load("classpath:io/reactiverse/es4x/polyfill/promise.js");
      // install the commonjs loader
      load("classpath:io/reactiverse/es4x/jvm-npm.js");
    }
  }
})(this);
